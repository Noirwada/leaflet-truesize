{"version":3,"file":"Leaflet.TrueSize.js","sources":["../src/index.js"],"sourcesContent":["import L from 'leaflet';\nimport '@webk1d/leaflet-curve';\nimport turf from '@turf/helpers';\nimport turfCenter from '@turf/center';\n\nlet id = 0;\n\nL.SwoopyArrow = L.Layer.extend({\n  fromLatlng: [],\n  toLatlng: [],\n  options: {\n    color: '#222422',\n    weight: 1,\n    opacity: 1,\n    factor: 0.5,\n    arrowFilled: false,\n    arrowId: null,\n    minZoom: 0,\n    maxZoom: 22,\n    label: '',\n    labelClassName: '',\n    labelFontSize: 12,\n    labelColor: '#222222',\n    html: '',\n    iconAnchor: [0, 0],\n    iconSize: [50, 20],\n  },\n\n  initialize: function (fromLatlng, toLatlng, options) {\n    L.Util.setOptions(this, options);\n\n    this._currentPathVisible = true;\n    this._fromLatlng = L.latLng(fromLatlng);\n    this._toLatlng = L.latLng(toLatlng);\n    this._factor = this.options.factor;\n    this._label = this.options.label;\n    this._labelFontSize = this.options.labelFontSize;\n    this._labelColor = this.options.labelColor;\n    this._color = this.options.color;\n    this._labelClassName = this.options.labelClassName;\n    this._html = this.options.html;\n    this._opacity = this.options.opacity;\n    this._minZoom = this.options.minZoom;\n    this._maxZoom = this.options.maxZoom;\n    this._iconAnchor = this.options.iconAnchor;\n    this._iconSize = this.options.iconSize;\n    this._weight = this.options.weight;\n    this._arrowFilled = this.options.arrowFilled;\n    this._arrowId = this.options.arrowId;\n\n    this._initSVG();\n  },\n\n  _initSVG: function () {\n    this._svg = L.SVG.create('svg');\n    this._currentId = id++;\n    this._arrow = this._createArrow();\n    this._svg.appendChild(this._arrow);\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n    this.getPane().appendChild(this._svg);\n\n    this._drawSwoopyArrows();\n\n    this.update(this._map);\n  },\n\n  getEvents: function () {\n    return {\n      zoom: this.update,\n      viewreset: this.update\n    };\n  },\n\n  _drawSwoopyArrows: function() {\n    const swoopyPath = this._createPath();\n    this._currentPath = swoopyPath._path;\n\n    const swoopyLabel = this._createLabel();\n    this._currentMarker = L.marker([this._fromLatlng.lat, this._fromLatlng.lng], { icon: swoopyLabel }).addTo(this._map);\n  },\n\n  _createArrow: function () {\n    this._container = this._container || L.SVG.create('defs');\n    const marker = L.SVG.create('marker');\n    const path = L.SVG.create('polyline');\n\n    marker.setAttribute('class', 'swoopyArrow__marker');\n    marker.setAttribute('id', `swoopyarrow__arrowhead${this._currentId}`);\n    marker.setAttribute('markerWidth', '6.75');\n    marker.setAttribute('markerHeight', '6.75');\n    marker.setAttribute('viewBox', '-10 -10 20 20');\n    marker.setAttribute('orient', 'auto');\n    marker.setAttribute('refX', '0');\n    marker.setAttribute('refY', '0');\n    marker.setAttribute('fill', 'none');\n    marker.setAttribute('stroke', this._color);\n    marker.setAttribute('stroke-width', this._weight);\n    marker.setAttribute('opacity', this._opacity);\n\n    path.setAttribute('stroke-linejoin', 'bevel');\n    path.setAttribute('fill', this._arrowFilled ? this._color : 'none');\n    path.setAttribute('stroke', this._color);\n    path.setAttribute('points', '-6.75,-6.75 0,0 -6.75,6.75');\n    marker.appendChild(path);\n\n    this._container.appendChild(marker);\n\n    return this._container;\n  },\n\n  _createPath: function () {\n    const controlLatlng = this._getControlPoint(L.latLng(this._fromLatlng), L.latLng(this._toLatlng), this.options.factor);\n    const pathOne = L.curve([\n      'M', [this._fromLatlng.lat, this._fromLatlng.lng],\n      'Q', [controlLatlng.lat, controlLatlng.lng], [this._toLatlng.lat, this._toLatlng.lng]\n      ], {\n        animate: false,\n        color: this._color,\n        fill: false,\n        opacity: this._opacity,\n        weight: this._weight,\n        className: 'swoopyarrow__path'\n      }\n    ).addTo(this._map);\n\n\n    pathOne._path.setAttribute('id', `swoopyarrow__path${this._currentId}`);\n    pathOne._path.setAttribute('marker-end', !this._arrowId ?\n      `url(#swoopyarrow__arrowhead${this._currentId})` :\n      `url(${this._arrowId})`\n     );\n\n    return pathOne;\n  },\n\n\n  _rotatePoint: function (origin, point, angle) {\n    const radians = angle * Math.PI / 180.0;\n\n    return {\n      x: Math.cos(radians) * (point.x - origin.x) - Math.sin(radians) * (point.y - origin.y) + origin.x,\n      y: Math.sin(radians) * (point.x - origin.x) + Math.cos(radians) * (point.y - origin.y) + origin.y\n    };\n  },\n\n  _getControlPoint: function (start, end, factor) {\n    const features = turf.featureCollection([\n      turf.point([start.lat, start.lng]),\n      turf.point([end.lat, end.lng])\n    ]);\n\n    const center = turfCenter(features);\n\n    // get pixel coordinates for start, end and center\n    const startPx = this._map.latLngToContainerPoint(start);\n    const centerPx = this._map.latLngToContainerPoint(L.latLng(center.geometry.coordinates[0], center.geometry.coordinates[1]));\n    const rotatedPx = this._rotatePoint(centerPx, startPx, 90);\n\n    const distance = Math.sqrt(Math.pow(startPx.x - centerPx.x, 2) + Math.pow(startPx.y - centerPx.y, 2));\n    const angle = Math.atan2(rotatedPx.y - centerPx.y, rotatedPx.x - centerPx.x);\n    const offset = (factor * distance) - distance;\n\n    const sin = Math.sin(angle) * offset;\n    const cos = Math.cos(angle) * offset;\n\n    const controlPoint = L.point(rotatedPx.x + cos, rotatedPx.y + sin);\n\n    return this._map.containerPointToLatLng(controlPoint);\n  },\n\n  _createLabel: function() {\n    return L.divIcon({\n      className: this._html === '' && this._labelClassName,\n      html: this._html === ''  ? `<span id=\"marker-label${this._currentId}\" style=\"font-size: ${this._labelFontSize}px; color: ${this._labelColor}\">${this._label}</span>` : this._html,\n      iconAnchor: this._iconAnchor,\n      iconSize: this._iconSize\n    });\n  },\n\n  update: function(map) {\n    this._checkZoomLevel();\n\n    const arrowHead = this._svg.getElementById(`swoopyarrow__arrowhead${this._currentId}`);\n    arrowHead.setAttribute('markerWidth', `${2.5 * this._map.getZoom()}`);\n    arrowHead.setAttribute('markerHeight', `${2.5 * this._map.getZoom()}`);\n\n    return this;\n  },\n\n  _checkZoomLevel: function() {\n    const currentZoomLevel = this._map.getZoom();\n\n    if(!this._currentPathVisible) {\n      this._currentPath.setAttribute('opacity', this._opacity);\n      this._currentMarker.setOpacity(this._opacity);\n    }\n\n    if(currentZoomLevel < this._minZoom || currentZoomLevel > this._maxZoom) {\n      this._currentPath.setAttribute('opacity', 0);\n      this._currentMarker.setOpacity(0);\n\n      this._currentPathVisible = false;\n    }\n  },\n\n  onRemove: function(map) {\n    this._map = map;\n    this._currentPath.parentNode.removeChild(this._currentPath);\n    this._map.removeLayer(this._currentMarker);\n  }\n});\n\nL.swoopyArrow = (fromLatlng, toLatlng, options) => new L.SwoopyArrow(fromLatlng, toLatlng, options);\n"],"names":["id","L","SwoopyArrow","Layer","extend","fromLatlng","toLatlng","options","Util","setOptions","_currentPathVisible","_fromLatlng","latLng","_toLatlng","_factor","factor","_label","label","_labelFontSize","labelFontSize","_labelColor","labelColor","_color","color","_labelClassName","labelClassName","_html","html","_opacity","opacity","_minZoom","minZoom","_maxZoom","maxZoom","_iconAnchor","iconAnchor","_iconSize","iconSize","_weight","weight","_arrowFilled","arrowFilled","_arrowId","arrowId","_initSVG","_svg","SVG","create","_currentId","_arrow","_createArrow","appendChild","map","_map","getPane","_drawSwoopyArrows","update","swoopyPath","_createPath","_currentPath","_path","swoopyLabel","_createLabel","_currentMarker","marker","lat","lng","icon","addTo","_container","path","setAttribute","controlLatlng","_getControlPoint","pathOne","curve","origin","point","angle","radians","Math","PI","cos","x","sin","y","start","end","features","turf","featureCollection","center","turfCenter","startPx","latLngToContainerPoint","centerPx","geometry","coordinates","rotatedPx","_rotatePoint","distance","sqrt","pow","atan2","offset","controlPoint","containerPointToLatLng","divIcon","_checkZoomLevel","arrowHead","getElementById","getZoom","currentZoomLevel","setOpacity","parentNode","removeChild","removeLayer","swoopyArrow"],"mappings":";;;;;;;;;;;AAKA,IAAIA,KAAK,CAAT;;AAEAC,EAAEC,WAAF,GAAgBD,EAAEE,KAAF,CAAQC,MAAR,CAAe;cACjB,EADiB;YAEnB,EAFmB;WAGpB;WACA,SADA;YAEC,CAFD;aAGE,CAHF;YAIC,GAJD;iBAKM,KALN;aAME,IANF;aAOE,CAPF;aAQE,EARF;WASA,EATA;oBAUS,EAVT;mBAWQ,EAXR;gBAYK,SAZL;UAaD,EAbC;gBAcK,CAAC,CAAD,EAAI,CAAJ,CAdL;cAeG,CAAC,EAAD,EAAK,EAAL;GAlBiB;;cAqBjB,oBAAUC,UAAV,EAAsBC,QAAtB,EAAgCC,OAAhC,EAAyC;MACjDC,IAAF,CAAOC,UAAP,CAAkB,IAAlB,EAAwBF,OAAxB;;SAEKG,mBAAL,GAA2B,IAA3B;SACKC,WAAL,GAAmBV,EAAEW,MAAF,CAASP,UAAT,CAAnB;SACKQ,SAAL,GAAiBZ,EAAEW,MAAF,CAASN,QAAT,CAAjB;SACKQ,OAAL,GAAe,KAAKP,OAAL,CAAaQ,MAA5B;SACKC,MAAL,GAAc,KAAKT,OAAL,CAAaU,KAA3B;SACKC,cAAL,GAAsB,KAAKX,OAAL,CAAaY,aAAnC;SACKC,WAAL,GAAmB,KAAKb,OAAL,CAAac,UAAhC;SACKC,MAAL,GAAc,KAAKf,OAAL,CAAagB,KAA3B;SACKC,eAAL,GAAuB,KAAKjB,OAAL,CAAakB,cAApC;SACKC,KAAL,GAAa,KAAKnB,OAAL,CAAaoB,IAA1B;SACKC,QAAL,GAAgB,KAAKrB,OAAL,CAAasB,OAA7B;SACKC,QAAL,GAAgB,KAAKvB,OAAL,CAAawB,OAA7B;SACKC,QAAL,GAAgB,KAAKzB,OAAL,CAAa0B,OAA7B;SACKC,WAAL,GAAmB,KAAK3B,OAAL,CAAa4B,UAAhC;SACKC,SAAL,GAAiB,KAAK7B,OAAL,CAAa8B,QAA9B;SACKC,OAAL,GAAe,KAAK/B,OAAL,CAAagC,MAA5B;SACKC,YAAL,GAAoB,KAAKjC,OAAL,CAAakC,WAAjC;SACKC,QAAL,GAAgB,KAAKnC,OAAL,CAAaoC,OAA7B;;SAEKC,QAAL;GA3C2B;;YA8CnB,oBAAY;SACfC,IAAL,GAAY5C,EAAE6C,GAAF,CAAMC,MAAN,CAAa,KAAb,CAAZ;SACKC,UAAL,GAAkBhD,IAAlB;SACKiD,MAAL,GAAc,KAAKC,YAAL,EAAd;SACKL,IAAL,CAAUM,WAAV,CAAsB,KAAKF,MAA3B;GAlD2B;;SAqDtB,eAAUG,GAAV,EAAe;SACfC,IAAL,GAAYD,GAAZ;SACKE,OAAL,GAAeH,WAAf,CAA2B,KAAKN,IAAhC;;SAEKU,iBAAL;;SAEKC,MAAL,CAAY,KAAKH,IAAjB;GA3D2B;;aA8DlB,qBAAY;WACd;YACC,KAAKG,MADN;iBAEM,KAAKA;KAFlB;GA/D2B;;qBAqEV,6BAAW;QACtBC,aAAa,KAAKC,WAAL,EAAnB;SACKC,YAAL,GAAoBF,WAAWG,KAA/B;;QAEMC,cAAc,KAAKC,YAAL,EAApB;SACKC,cAAL,GAAsB9D,EAAE+D,MAAF,CAAS,CAAC,KAAKrD,WAAL,CAAiBsD,GAAlB,EAAuB,KAAKtD,WAAL,CAAiBuD,GAAxC,CAAT,EAAuD,EAAEC,MAAMN,WAAR,EAAvD,EAA8EO,KAA9E,CAAoF,KAAKf,IAAzF,CAAtB;GA1E2B;;gBA6Ef,wBAAY;SACnBgB,UAAL,GAAkB,KAAKA,UAAL,IAAmBpE,EAAE6C,GAAF,CAAMC,MAAN,CAAa,MAAb,CAArC;QACMiB,SAAS/D,EAAE6C,GAAF,CAAMC,MAAN,CAAa,QAAb,CAAf;QACMuB,OAAOrE,EAAE6C,GAAF,CAAMC,MAAN,CAAa,UAAb,CAAb;;WAEOwB,YAAP,CAAoB,OAApB,EAA6B,qBAA7B;WACOA,YAAP,CAAoB,IAApB,6BAAmD,KAAKvB,UAAxD;WACOuB,YAAP,CAAoB,aAApB,EAAmC,MAAnC;WACOA,YAAP,CAAoB,cAApB,EAAoC,MAApC;WACOA,YAAP,CAAoB,SAApB,EAA+B,eAA/B;WACOA,YAAP,CAAoB,QAApB,EAA8B,MAA9B;WACOA,YAAP,CAAoB,MAApB,EAA4B,GAA5B;WACOA,YAAP,CAAoB,MAApB,EAA4B,GAA5B;WACOA,YAAP,CAAoB,MAApB,EAA4B,MAA5B;WACOA,YAAP,CAAoB,QAApB,EAA8B,KAAKjD,MAAnC;WACOiD,YAAP,CAAoB,cAApB,EAAoC,KAAKjC,OAAzC;WACOiC,YAAP,CAAoB,SAApB,EAA+B,KAAK3C,QAApC;;SAEK2C,YAAL,CAAkB,iBAAlB,EAAqC,OAArC;SACKA,YAAL,CAAkB,MAAlB,EAA0B,KAAK/B,YAAL,GAAoB,KAAKlB,MAAzB,GAAkC,MAA5D;SACKiD,YAAL,CAAkB,QAAlB,EAA4B,KAAKjD,MAAjC;SACKiD,YAAL,CAAkB,QAAlB,EAA4B,4BAA5B;WACOpB,WAAP,CAAmBmB,IAAnB;;SAEKD,UAAL,CAAgBlB,WAAhB,CAA4Ba,MAA5B;;WAEO,KAAKK,UAAZ;GAvG2B;;eA0GhB,uBAAY;QACjBG,gBAAgB,KAAKC,gBAAL,CAAsBxE,EAAEW,MAAF,CAAS,KAAKD,WAAd,CAAtB,EAAkDV,EAAEW,MAAF,CAAS,KAAKC,SAAd,CAAlD,EAA4E,KAAKN,OAAL,CAAaQ,MAAzF,CAAtB;QACM2D,UAAUzE,EAAE0E,KAAF,CAAQ,CACtB,GADsB,EACjB,CAAC,KAAKhE,WAAL,CAAiBsD,GAAlB,EAAuB,KAAKtD,WAAL,CAAiBuD,GAAxC,CADiB,EAEtB,GAFsB,EAEjB,CAACM,cAAcP,GAAf,EAAoBO,cAAcN,GAAlC,CAFiB,EAEuB,CAAC,KAAKrD,SAAL,CAAeoD,GAAhB,EAAqB,KAAKpD,SAAL,CAAeqD,GAApC,CAFvB,CAAR,EAGX;eACQ,KADR;aAEM,KAAK5C,MAFX;YAGK,KAHL;eAIQ,KAAKM,QAJb;cAKO,KAAKU,OALZ;iBAMU;KATC,EAWd8B,KAXc,CAWR,KAAKf,IAXG,CAAhB;;YAcQO,KAAR,CAAcW,YAAd,CAA2B,IAA3B,wBAAqD,KAAKvB,UAA1D;YACQY,KAAR,CAAcW,YAAd,CAA2B,YAA3B,EAAyC,CAAC,KAAK7B,QAAN,mCACT,KAAKM,UADI,kBAEhC,KAAKN,QAF2B,MAAzC;;WAKOgC,OAAP;GAhI2B;;gBAoIf,sBAAUE,MAAV,EAAkBC,KAAlB,EAAyBC,KAAzB,EAAgC;QACtCC,UAAUD,QAAQE,KAAKC,EAAb,GAAkB,KAAlC;;WAEO;SACFD,KAAKE,GAAL,CAASH,OAAT,KAAqBF,MAAMM,CAAN,GAAUP,OAAOO,CAAtC,IAA2CH,KAAKI,GAAL,CAASL,OAAT,KAAqBF,MAAMQ,CAAN,GAAUT,OAAOS,CAAtC,CAA3C,GAAsFT,OAAOO,CAD3F;SAEFH,KAAKI,GAAL,CAASL,OAAT,KAAqBF,MAAMM,CAAN,GAAUP,OAAOO,CAAtC,IAA2CH,KAAKE,GAAL,CAASH,OAAT,KAAqBF,MAAMQ,CAAN,GAAUT,OAAOS,CAAtC,CAA3C,GAAsFT,OAAOS;KAFlG;GAvI2B;;oBA6IX,0BAAUC,KAAV,EAAiBC,GAAjB,EAAsBxE,MAAtB,EAA8B;QACxCyE,WAAWC,KAAKC,iBAAL,CAAuB,CACtCD,KAAKZ,KAAL,CAAW,CAACS,MAAMrB,GAAP,EAAYqB,MAAMpB,GAAlB,CAAX,CADsC,EAEtCuB,KAAKZ,KAAL,CAAW,CAACU,IAAItB,GAAL,EAAUsB,IAAIrB,GAAd,CAAX,CAFsC,CAAvB,CAAjB;;QAKMyB,SAASC,WAAWJ,QAAX,CAAf;;;QAGMK,UAAU,KAAKxC,IAAL,CAAUyC,sBAAV,CAAiCR,KAAjC,CAAhB;QACMS,WAAW,KAAK1C,IAAL,CAAUyC,sBAAV,CAAiC7F,EAAEW,MAAF,CAAS+E,OAAOK,QAAP,CAAgBC,WAAhB,CAA4B,CAA5B,CAAT,EAAyCN,OAAOK,QAAP,CAAgBC,WAAhB,CAA4B,CAA5B,CAAzC,CAAjC,CAAjB;QACMC,YAAY,KAAKC,YAAL,CAAkBJ,QAAlB,EAA4BF,OAA5B,EAAqC,EAArC,CAAlB;;QAEMO,WAAWpB,KAAKqB,IAAL,CAAUrB,KAAKsB,GAAL,CAAST,QAAQV,CAAR,GAAYY,SAASZ,CAA9B,EAAiC,CAAjC,IAAsCH,KAAKsB,GAAL,CAAST,QAAQR,CAAR,GAAYU,SAASV,CAA9B,EAAiC,CAAjC,CAAhD,CAAjB;QACMP,QAAQE,KAAKuB,KAAL,CAAWL,UAAUb,CAAV,GAAcU,SAASV,CAAlC,EAAqCa,UAAUf,CAAV,GAAcY,SAASZ,CAA5D,CAAd;QACMqB,SAAUzF,SAASqF,QAAV,GAAsBA,QAArC;;QAEMhB,MAAMJ,KAAKI,GAAL,CAASN,KAAT,IAAkB0B,MAA9B;QACMtB,MAAMF,KAAKE,GAAL,CAASJ,KAAT,IAAkB0B,MAA9B;;QAEMC,eAAexG,EAAE4E,KAAF,CAAQqB,UAAUf,CAAV,GAAcD,GAAtB,EAA2BgB,UAAUb,CAAV,GAAcD,GAAzC,CAArB;;WAEO,KAAK/B,IAAL,CAAUqD,sBAAV,CAAiCD,YAAjC,CAAP;GAnK2B;;gBAsKf,wBAAW;WAChBxG,EAAE0G,OAAF,CAAU;iBACJ,KAAKjF,KAAL,KAAe,EAAf,IAAqB,KAAKF,eADtB;YAET,KAAKE,KAAL,KAAe,EAAf,8BAA8C,KAAKsB,UAAnD,4BAAoF,KAAK9B,cAAzF,mBAAqH,KAAKE,WAA1H,UAA0I,KAAKJ,MAA/I,eAAiK,KAAKU,KAF7J;kBAGH,KAAKQ,WAHF;gBAIL,KAAKE;KAJV,CAAP;GAvK2B;;UA+KrB,gBAASgB,GAAT,EAAc;SACfwD,eAAL;;QAEMC,YAAY,KAAKhE,IAAL,CAAUiE,cAAV,4BAAkD,KAAK9D,UAAvD,CAAlB;cACUuB,YAAV,CAAuB,aAAvB,OAAyC,MAAM,KAAKlB,IAAL,CAAU0D,OAAV,EAA/C;cACUxC,YAAV,CAAuB,cAAvB,OAA0C,MAAM,KAAKlB,IAAL,CAAU0D,OAAV,EAAhD;;WAEO,IAAP;GAtL2B;;mBAyLZ,2BAAW;QACpBC,mBAAmB,KAAK3D,IAAL,CAAU0D,OAAV,EAAzB;;QAEG,CAAC,KAAKrG,mBAAT,EAA8B;WACvBiD,YAAL,CAAkBY,YAAlB,CAA+B,SAA/B,EAA0C,KAAK3C,QAA/C;WACKmC,cAAL,CAAoBkD,UAApB,CAA+B,KAAKrF,QAApC;;;QAGCoF,mBAAmB,KAAKlF,QAAxB,IAAoCkF,mBAAmB,KAAKhF,QAA/D,EAAyE;WAClE2B,YAAL,CAAkBY,YAAlB,CAA+B,SAA/B,EAA0C,CAA1C;WACKR,cAAL,CAAoBkD,UAApB,CAA+B,CAA/B;;WAEKvG,mBAAL,GAA2B,KAA3B;;GArMyB;;YAyMnB,kBAAS0C,GAAT,EAAc;SACjBC,IAAL,GAAYD,GAAZ;SACKO,YAAL,CAAkBuD,UAAlB,CAA6BC,WAA7B,CAAyC,KAAKxD,YAA9C;SACKN,IAAL,CAAU+D,WAAV,CAAsB,KAAKrD,cAA3B;;CA5MY,CAAhB;;AAgNA9D,EAAEoH,WAAF,GAAgB,UAAChH,UAAD,EAAaC,QAAb,EAAuBC,OAAvB;SAAmC,IAAIN,EAAEC,WAAN,CAAkBG,UAAlB,EAA8BC,QAA9B,EAAwCC,OAAxC,CAAnC;CAAhB;;;;"}